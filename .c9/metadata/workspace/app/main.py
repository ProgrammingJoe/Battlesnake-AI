{"filter":false,"title":"main.py","tooltip":"/app/main.py","undoManager":{"mark":90,"position":90,"stack":[[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":44,"column":0},"action":"remove","lines":["import bottle","import json","","","@bottle.get('/')","def index():","    return \"\"\"","        <a href=\"https://github.com/sendwithus/battlesnake-python\">","            battlesnake-python","        </a>","    \"\"\"","","","@bottle.post('/start')","def start():","    data = bottle.request.json","","    return json.dumps({","        'name': 'battlesnake-python',","        'color': '#00ff00',","        'head_url': 'http://battlesnake-python.herokuapp.com',","        'taunt': 'battlesnake-python!'","    })","","","@bottle.post('/move')","def move():","    data = bottle.request.json","","    return json.dumps({","        'move': 'left',","        'taunt': 'battlesnake-python!'","    })","","","@bottle.post('/end')","def end():","    data = bottle.request.json","","    return json.dumps({})","","","# Expose WSGI app","application = bottle.default_app()",""]},{"start":{"row":0,"column":0},"end":{"row":135,"column":13},"action":"insert","lines":["import bottle","import json","import heapq","import random","","################################################################################","# Constants                                                                    #","################################################################################","snakeName = 'snakes-on-a-plane'","directions = {","\t(-1, 0): 'left',","\t(1, 0): 'right',","\t(0, -1): 'up',","\t(0, 1): 'down'","}","","################################################################################","# Classes                                                                      #","################################################################################","","##","# Basic priority queue, minimum value at top","#","class PriorityQueue:","\tdef __init__(self):","\t\tself.elements = []","\t","\tdef empty(self):","\t\treturn len(self.elements) == 0","\t","\tdef enqueue(self, element, priority):","\t\theapq.heappush(self.elements, (priority, element))","\t","\tdef dequeue(self):","\t\treturn heapq.heappop(self.elements)[1]","","##","# Used for converting backwards path returned by A* to forwards, also finding","# direction to move","#","class Path:","\tdef cameFrom(cameFrom, goal):","\t\tgoTo = { goal: None }","\t\tstart = goal","\t\twhile cameFrom[start]:","\t\t\tgoTo[cameFrom[start]] = start","\t\t\tstart = cameFrom[start]","\t\treturn Path(goTo, start)","","\tdef __init__(self, goTo, start):","\t\tself.goTo = goTo","\t\tself.start = start","","\tdef direction(self):","\t\tnxt = self.goTo[self.start]","\t\treturn (nxt[0] - self.start[0], nxt[1] - self.start[1])","","##","# Grid to use for pathfinding, has obstructions to be navigated around","#","class Grid:","\tdef __init__(self, width, height):","\t\tself.width = width","\t\tself.height = height","\t\tself.cells = [ [ 0 for y in range(height) ] for x in range(width) ]","\t","\t# Finds a random, unobstructed cell on the grid","\tdef random(self):","\t\tcell = None","\t\twhile cell == None or self.obstructed(cell):","\t\t\tx = random.randint(0, self.width - 1)","\t\t\ty = random.randint(0, self.height - 1)","\t\t\tcell = (x, y)","\t\treturn cell","","\t# Checks if the grid contains a cell","\tdef contains(self, cell):","\t\treturn (cell[0] >= 0","\t\t\tand cell[1] >= 0","\t\t\tand cell[0] < self.width","\t\t\tand cell[1] < self.height)","","\t# Obstructs a cell on the grid","\tdef obstruct(self, cell):","\t\tself.cells[cell[0]][cell[1]] = 1","\t","\t# Checks if a cell on the grid is obstructed","\tdef obstructed(self, cell):","\t\treturn self.cells[cell[0]][cell[1]] == 1","","\t# Heuristic for pathfinding, not currently used","\tdef heuristic(self, cell):","\t\treturn self.cells[cell[0]][cell[1]]","","\t# Finds neighbours to a cell on the grid","\tdef neighbours(self, cell):","\t\tneighbours = []","\t\tfor direction in directions:","\t\t\tneighbour = (cell[0] + direction[0], cell[1] + direction[1])","\t\t\t","\t\t\t# Check if on grid, and not obstructed","\t\t\tif self.contains(neighbour) and not self.obstructed(neighbour):","\t\t\t\tneighbours.append(neighbour)","\t\t","\t\treturn neighbours","","################################################################################","# Functions                                                                    #","################################################################################","","# xDist + yDist","def manDist(a, b):","\treturn abs(a[0] - b[0]) + abs(a[1] - b[1])","","","# A* search, uses grid's heuristic","def aStar(grid, start, goal):","\tfrontier = PriorityQueue()","\tfrontier.enqueue(start, 0)","\tcameFrom = { start: None }","\tcostSoFar = { start: 0 }","","\twhile not frontier.empty():","\t\tcurrent = frontier.dequeue()","\t\tif current == goal:","\t\t\treturn Path.cameFrom(cameFrom, goal)","","\t\tfor neighbour in grid.neighbours(current):","\t\t\tcost = costSoFar[current] + grid.heuristic(neighbour)","","\t\t\tif neighbour not in costSoFar or cost < costSoFar[neighbour]:","\t\t\t\tcostSoFar[neighbour] = cost","\t\t\t\tpriority = cost + manDist(neighbour, goal)","\t\t\t\tfrontier.enqueue(neighbour, priority)","\t\t\t\tcameFrom[neighbour] = current","\treturn False"]}]}],[{"group":"doc","deltas":[{"start":{"row":90,"column":48},"end":{"row":91,"column":39},"action":"insert","lines":[" for anything","\t# most likely use it to represent risk"]},{"start":{"row":115,"column":0},"end":{"row":116,"column":0},"action":"remove","lines":["",""]},{"start":{"row":135,"column":13},"end":{"row":205,"column":34},"action":"insert","lines":["","","","################################################################################","# Server                                                                       #","################################################################################","","@bottle.get('/')","def index():","    return \"\"\"","        <a href=\"https://github.com/sendwithus/battlesnake-python\">","            battlesnake-python","        </a>","    \"\"\"","","","@bottle.post('/start')","def start():","    data = bottle.request.json","","    return json.dumps({","        'name': snakeName,","        'color': '#00ff00',","        'head_url': 'http://battlesnake-python.herokuapp.com',","        'taunt': 'battlesnake-python!'","    })","","","@bottle.post('/move')","def move():","    data = bottle.request.json","","","    ourSnake = None","    ","    grid = Grid(len(data.board[0]), len(data.board))","    for snake in data.snakes:","        if snake.state != \"dead\":","            for coord in snake.coords:","                grid.obstruct(coord)","            if snake.name != snakeName:","                for direction in directions:","                    head = snake.coords[0]","                    movement = (head[0] + direction[0], head[1] + direction[1])","                    grid.obstruct(movement)","            else:","                ourSnake = snake","            ","    path = aStar(grid, snake.coords[0], data.food[0])","    ","    ","    move = 'left'","    ","    if path != False:","        move = directions[path.direction()]","","","    return json.dumps({","        'move': move,","        'taunt': 'battlesnake-python!'","    })","","","@bottle.post('/end')","def end():","    data = bottle.request.json","","    return json.dumps({})","","# Expose WSGI app","application = bottle.default_app()"]}]}],[{"group":"doc","deltas":[{"start":{"row":172,"column":23},"end":{"row":172,"column":24},"action":"remove","lines":["!"]}]}],[{"group":"doc","deltas":[{"start":{"row":172,"column":23},"end":{"row":172,"column":24},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":172,"column":27},"end":{"row":172,"column":31},"action":"remove","lines":["dead"]},{"start":{"row":172,"column":27},"end":{"row":172,"column":28},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":172,"column":28},"end":{"row":172,"column":29},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":172,"column":29},"end":{"row":172,"column":30},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":172,"column":30},"end":{"row":172,"column":31},"action":"insert","lines":["v"]}]}],[{"group":"doc","deltas":[{"start":{"row":172,"column":31},"end":{"row":172,"column":32},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":183,"column":23},"end":{"row":183,"column":28},"action":"remove","lines":["snake"]},{"start":{"row":183,"column":23},"end":{"row":183,"column":24},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":183,"column":24},"end":{"row":183,"column":25},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":183,"column":25},"end":{"row":183,"column":26},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":183,"column":26},"end":{"row":183,"column":27},"action":"insert","lines":["S"]}]}],[{"group":"doc","deltas":[{"start":{"row":183,"column":27},"end":{"row":183,"column":28},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":183,"column":27},"end":{"row":183,"column":28},"action":"remove","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":183,"column":26},"end":{"row":183,"column":27},"action":"remove","lines":["S"]}]}],[{"group":"doc","deltas":[{"start":{"row":183,"column":25},"end":{"row":183,"column":26},"action":"remove","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":183,"column":25},"end":{"row":183,"column":26},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":183,"column":26},"end":{"row":183,"column":27},"action":"insert","lines":["S"]}]}],[{"group":"doc","deltas":[{"start":{"row":183,"column":27},"end":{"row":183,"column":28},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":183,"column":28},"end":{"row":183,"column":29},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":183,"column":29},"end":{"row":183,"column":30},"action":"insert","lines":["k"]}]}],[{"group":"doc","deltas":[{"start":{"row":183,"column":30},"end":{"row":183,"column":31},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":167,"column":0},"end":{"row":167,"column":1},"action":"insert","lines":["\t"]}]}],[{"group":"doc","deltas":[{"start":{"row":167,"column":1},"end":{"row":167,"column":2},"action":"insert","lines":[":"]}]}],[{"group":"doc","deltas":[{"start":{"row":167,"column":2},"end":{"row":167,"column":3},"action":"insert","lines":[":"]}]}],[{"group":"doc","deltas":[{"start":{"row":167,"column":2},"end":{"row":167,"column":3},"action":"remove","lines":[":"]}]}],[{"group":"doc","deltas":[{"start":{"row":167,"column":1},"end":{"row":167,"column":2},"action":"remove","lines":[":"]}]}],[{"group":"doc","deltas":[{"start":{"row":167,"column":1},"end":{"row":167,"column":2},"action":"insert","lines":["\""]}]}],[{"group":"doc","deltas":[{"start":{"row":167,"column":2},"end":{"row":167,"column":3},"action":"insert","lines":["\""]}]}],[{"group":"doc","deltas":[{"start":{"row":167,"column":3},"end":{"row":167,"column":4},"action":"insert","lines":["\""]}]}],[{"group":"doc","deltas":[{"start":{"row":190,"column":0},"end":{"row":190,"column":1},"action":"insert","lines":["\""]}]}],[{"group":"doc","deltas":[{"start":{"row":190,"column":0},"end":{"row":190,"column":1},"action":"remove","lines":["\""]}]}],[{"group":"doc","deltas":[{"start":{"row":190,"column":0},"end":{"row":190,"column":1},"action":"insert","lines":["\t"]}]}],[{"group":"doc","deltas":[{"start":{"row":190,"column":1},"end":{"row":190,"column":2},"action":"insert","lines":["\""]}]}],[{"group":"doc","deltas":[{"start":{"row":190,"column":2},"end":{"row":190,"column":3},"action":"insert","lines":["\""]}]}],[{"group":"doc","deltas":[{"start":{"row":190,"column":3},"end":{"row":190,"column":4},"action":"insert","lines":["\""]}]}],[{"group":"doc","deltas":[{"start":{"row":190,"column":4},"end":{"row":191,"column":0},"action":"insert","lines":["",""]},{"start":{"row":191,"column":0},"end":{"row":191,"column":1},"action":"insert","lines":["\t"]}]}],[{"group":"doc","deltas":[{"start":{"row":191,"column":1},"end":{"row":192,"column":0},"action":"insert","lines":["",""]},{"start":{"row":192,"column":0},"end":{"row":192,"column":1},"action":"insert","lines":["\t"]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":1},"end":{"row":192,"column":2},"action":"insert","lines":["m"]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":2},"end":{"row":192,"column":3},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":3},"end":{"row":192,"column":4},"action":"insert","lines":["v"]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":4},"end":{"row":192,"column":5},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":5},"end":{"row":192,"column":6},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":6},"end":{"row":192,"column":7},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":7},"end":{"row":192,"column":8},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":8},"end":{"row":192,"column":9},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":9},"end":{"row":192,"column":10},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":10},"end":{"row":192,"column":11},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":11},"end":{"row":192,"column":12},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":12},"end":{"row":192,"column":13},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":13},"end":{"row":192,"column":14},"action":"insert","lines":["m"]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":14},"end":{"row":192,"column":15},"action":"insert","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":15},"end":{"row":192,"column":16},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":16},"end":{"row":192,"column":17},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":17},"end":{"row":192,"column":18},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":18},"end":{"row":192,"column":19},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":18},"end":{"row":192,"column":19},"action":"remove","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":17},"end":{"row":192,"column":18},"action":"remove","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":16},"end":{"row":192,"column":17},"action":"remove","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":15},"end":{"row":192,"column":16},"action":"remove","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":14},"end":{"row":192,"column":15},"action":"remove","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":13},"end":{"row":192,"column":14},"action":"remove","lines":["m"]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":12},"end":{"row":192,"column":13},"action":"remove","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":11},"end":{"row":192,"column":12},"action":"remove","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":10},"end":{"row":192,"column":11},"action":"remove","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":9},"end":{"row":192,"column":10},"action":"remove","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":8},"end":{"row":192,"column":9},"action":"remove","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":7},"end":{"row":192,"column":8},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":6},"end":{"row":192,"column":7},"action":"remove","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":5},"end":{"row":192,"column":6},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":4},"end":{"row":192,"column":5},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":3},"end":{"row":192,"column":4},"action":"remove","lines":["v"]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":2},"end":{"row":192,"column":3},"action":"remove","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":1},"end":{"row":192,"column":2},"action":"remove","lines":["m"]}]}],[{"group":"doc","deltas":[{"start":{"row":192,"column":0},"end":{"row":192,"column":1},"action":"remove","lines":["\t"]}]}],[{"group":"doc","deltas":[{"start":{"row":191,"column":1},"end":{"row":192,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":191,"column":0},"end":{"row":191,"column":1},"action":"remove","lines":["\t"]}]}],[{"group":"doc","deltas":[{"start":{"row":190,"column":4},"end":{"row":191,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":190,"column":3},"end":{"row":190,"column":4},"action":"remove","lines":["\""]}]}],[{"group":"doc","deltas":[{"start":{"row":190,"column":2},"end":{"row":190,"column":3},"action":"remove","lines":["\""]}]}],[{"group":"doc","deltas":[{"start":{"row":190,"column":1},"end":{"row":190,"column":2},"action":"remove","lines":["\""]}]}],[{"group":"doc","deltas":[{"start":{"row":167,"column":1},"end":{"row":167,"column":2},"action":"remove","lines":["\""]}]}],[{"group":"doc","deltas":[{"start":{"row":167,"column":1},"end":{"row":167,"column":2},"action":"remove","lines":["\""]}]}],[{"group":"doc","deltas":[{"start":{"row":167,"column":1},"end":{"row":167,"column":2},"action":"remove","lines":["\""]}]}],[{"group":"doc","deltas":[{"start":{"row":167,"column":1},"end":{"row":168,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":167,"column":1},"end":{"row":167,"column":2},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":167,"column":1},"end":{"row":167,"column":2},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":167,"column":1},"end":{"row":167,"column":2},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":167,"column":1},"end":{"row":167,"column":2},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":157,"column":19},"end":{"row":157,"column":25},"action":"remove","lines":["00ff00"]},{"start":{"row":157,"column":19},"end":{"row":157,"column":25},"action":"insert","lines":["EF0006"]}]}]]},"ace":{"folds":[],"scrolltop":1608,"scrollleft":0,"selection":{"start":{"row":171,"column":34},"end":{"row":171,"column":34},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":113,"state":"start","mode":"ace/mode/python"}},"timestamp":1424555744100,"hash":"1546a49504b087823641f25cf1c8399335df962c"}